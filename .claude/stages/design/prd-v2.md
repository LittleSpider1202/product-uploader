# 淘宝商品一键上架工具 PRD v2

---

## 概览

### 文档信息

| 项目 | 内容 |
|------|------|
| 版本 | v2.1 |
| 状态 | 进行中 |
| 更新日期 | 2026-02-01 |

### 目录结构

| # | 章节 | 概要 |
|---|------|------|
| 1 | 背景与目标 | 继承 v1，手动上架效率低，目标单品 <5 分钟 |
| 2 | 用户画像与场景 | 继承 v1，MVP 优先新手卖家 |
| 3 | 功能范围 | 继承 v1，做：采集+预览+上架 |
| 4 | 系统解构 | **重大变更**：Open API 方案替代浏览器模拟 |
| 5 | **字段清单** | **新增**：完整字段与来源映射 |
| 6 | 评价体系 | 继承 v1 |
| 7 | 优化回路 | 简化，API 方案无需 codegen 录制 |
| 8 | **交互设计** | **重大变更**：Web GUI + 引导流程 + 字段匹配 |
| 9 | 数据设计 | 更新，适配 Schema 体系 + 外部数据源 |
| 10 | 异常与兜底 | 更新，API 错误处理 |
| 11 | 开放问题 | 更新 |

### v2.0 重大变更

| 变更项 | v1.x | v2.0 |
|--------|------|------|
| **技术方案** | 浏览器模拟（Playwright） | **淘宝 Open API** |
| **交互形式** | CLI 命令行 | **Web GUI 可视化界面** |
| **字段处理** | 学习模式 + 字段绑定 | **Schema 自动解析 + 人工确认** |
| **登录方式** | 扫码/Cookie | **OAuth 授权** |
| **稳定性** | 低（页面变化就失效） | **高（官方接口）** |

### v2.1 更新内容

| 更新项 | 说明 |
|--------|------|
| **字段清单** | 新增完整字段与来源映射表（第5节） |
| **外部数据源** | 支持钉钉/飞书表格作为数据源 |
| **类目模板** | 从店铺已有商品学习配置 |
| **引导流程** | 首次用户引导配置流程 |
| **交互设计** | 重新设计页面结构和流程 |

---

## 1-3 节：继承 v1.4 版本

> 第 1-3 节内容继承自 PRD v1.4，此处不重复。请参阅 `prd-v1.md`。

---

## 4. 系统解构（重大变更）

### 4.1 技术方案对比

| 对比项 | 浏览器模拟方案 | Open API 方案 |
|--------|---------------|---------------|
| 登录方式 | 扫码/Cookie | OAuth 授权 |
| 商品发布 | 模拟填表单 | 调用 Schema API |
| 字段处理 | 需要学习/绑定选择器 | 自动解析 Schema |
| 图片上传 | 模拟上传操作 | taobao.picture.upload |
| 稳定性 | 低（页面变化就失效） | 高（官方接口） |
| 维护成本 | 高（选择器维护） | 低 |
| 准入门槛 | 无 | 需要开放平台资质 |

**决策：采用 Open API 方案**

### 4.2 核心 API 调用链

```
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 0：OAuth 授权（一次性）                                         │
│                                                                     │
│   用户点击"连接店铺" → 跳转淘宝授权页 → 获取 access_token           │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 1：采集源商品数据                                               │
│                                                                     │
│   输入商品链接 → 爬取页面 → 提取商品信息                            │
│   （标题、价格、图片、SKU、描述等）                                  │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 2：上传图片                                                     │
│                                                                     │
│   taobao.picture.upload                                             │
│   → 返回图片 URL                                                    │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 3：获取发布规则 Schema                                          │
│                                                                     │
│   3.1 tmall.product.match.schema.get(category_id)                   │
│       → 获取产品匹配规则                                            │
│                                                                     │
│   3.2 tmall.product.schema.match(xml_data)                          │
│       → 匹配成功：获得 product_id                                   │
│       → 匹配失败：调用 tmall.product.add.schema.get 发布产品        │
│                                                                     │
│   3.3 tmall.item.add.schema.get(category_id, product_id)            │
│       → 获取商品发布规则 Schema                                     │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 4：字段匹配 + 人工确认                                          │
│                                                                     │
│   4.1 系统自动匹配：采集数据字段 ←→ Schema 字段                     │
│   4.2 展示匹配表格，用户确认/调整                                   │
│   4.3 用户填写未匹配的必填字段                                      │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 5：提交发布                                                     │
│                                                                     │
│   tmall.item.schema.add(category_id, product_id, xml_data)          │
│   → 返回 item_id（商品ID）                                          │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.3 Schema 体系说明

#### Schema 结构

Schema 是一个 XML 文档，由多个 `field` 组成，每个 field 描述一个字段规则：

| 属性 | 说明 |
|------|------|
| **id** | 字段唯一标识，如 `title`、`price` |
| **name** | 显示名称，如 "商品标题" |
| **type** | 输入类型 |
| **rules** | 校验规则（如必填、长度限制） |
| **options** | 可选值（用于单选/多选类型） |
| **default-value** | 默认值 |

#### Field 类型

| Schema Type | 中文 | 说明 |
|-------------|------|------|
| input | 文本 | 单行文本输入 |
| multiInput | 多值文本 | 多个文本值 |
| singleCheck | 单选 | 单选下拉 |
| multiCheck | 多选 | 多选复选框 |
| complex | 复合 | 嵌套结构 |
| multiComplex | 多项复合 | 数组嵌套结构 |
| label | 标签 | 只读展示 |

#### Schema 示例

**获取到的规则 Schema：**
```xml
<itemRule>
  <field id="title" name="商品标题" type="input">
    <rules>
      <rule name="requiredRule" value="true"/>
      <rule name="maxLengthRule" value="60"/>
    </rules>
  </field>
  <field id="prop_20000" name="品牌" type="singleCheck">
    <options>
      <option displayName="Nike" value="10000497"/>
      <option displayName="Adidas" value="10000498"/>
    </options>
  </field>
</itemRule>
```

**填充数据后提交的 XML：**
```xml
<itemRule>
  <field id="title" name="商品标题" type="input">
    <value>有机燕麦片 500g 即食早餐</value>
  </field>
  <field id="prop_20000" name="品牌" type="singleCheck">
    <value>10000497</value>
  </field>
</itemRule>
```

---

## 5. 字段清单与来源映射（新增）

### 5.1 字段来源分类

| 来源类型 | 说明 | 示例字段 |
|---------|------|---------|
| **源商品采集** | 从源商品页面抓取 | 标题、主图、详情、SKU规格 |
| **外部数据源** | 钉钉/飞书表格，按链接匹配 | 商家编码、有机编码、厂家、证书 |
| **类目模板** | 从店铺已有商品学习 | 物流、售后、发货地、厂家信息 |
| **AI生成** | 自动生成 | 白底图、3:4图 |
| **手动输入** | 每次必须人工填写 | 价格、库存 |

### 5.2 完整字段清单

> 注：必填列中 ✅=必填，⚠️=部分类目必填，❌=可选；已确认列待实际调用API后逐个确认。

#### 5.2.1 图文描述

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 1:1主图（5张） | image | ✅ | 源商品采集 | 至少1张 | ☐ |
| 3:4主图（5张） | image | ⚠️ | 源商品采集 / AI生成 | 部分类目必填 | ☐ |
| 白底图 | image | ⚠️ | AI生成 | 天猫通常必填 | ☐ |
| 商品视频 | video | ❌ | 源商品采集 | 可选 | ☐ |
| 商品卖点 | input | ❌ | 源商品采集 / AI生成 | 可选 | ☐ |
| PC详情 | richText | ✅ | 源商品采集 | | ☐ |
| 无线详情 | richText | ❌ | 源商品采集 | 可选 | ☐ |

#### 5.2.2 基础信息

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 商品标题 | input | ✅ | 源商品采集 | 需人工确认 | ☐ |
| 商品类目 | 类目ID | ✅ | 人工选择 | 源类目→目标类目映射 | ☐ |
| 商品品类 | singleCheck | ✅ | 类目Schema | 选类目后确定 | ☐ |
| 品牌 | singleCheck | ✅ | 源商品采集 + 匹配 | 需映射到目标品牌库 | ☐ |
| 系列 | singleCheck | ⚠️ | 源商品采集 + 匹配 | 部分类目必填 | ☐ |
| 规格 | input | ⚠️ | 源商品采集 | 部分类目必填 | ☐ |
| 货号 | input | ⚠️ | 源商品采集 / 手动 | 部分类目必填 | ☐ |

#### 5.2.3 食品安全（类目特有）

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 外包装类型 | singleCheck | ✅ | 类目模板 / 手动 | | ☐ |
| 组分表 | multiComplex | ❌ | 源商品采集 / 手动 | 营养成分 | ☐ |
| 生产许可证编号 | input | ✅ | 类目模板 | 同厂家可复用 | ☐ |
| 产品标准号 | input | ✅ | 类目模板 | | ☐ |
| 厂名 | input | ✅ | 外部数据源 / 类目模板 | | ☐ |
| 厂家联系方式 | input | ✅ | 类目模板 | | ☐ |
| 配料表 | input | ✅ | 源商品采集 | | ☐ |
| 保质期 | input | ✅ | 源商品采集 | | ☐ |
| 储藏方法 | input | ✅ | 源商品采集 | | ☐ |
| 食品添加剂 | input | ❌ | 源商品采集 | | ☐ |
| 有机编码 | input | ⚠️ | 外部数据源 | 有机食品必填 | ☐ |
| 有机证书图片 | image | ⚠️ | 外部数据源 | 有机食品必填 | ☐ |
| 条形码 | input | ✅ | 手动输入 / OCR | | ☐ |

#### 5.2.4 销售信息 - SKU

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| SKU规格名称 | input | ✅ | 源商品采集 | 如"有机黑芝麻600g" | ☐ |
| SKU搜索主图 | image | ❌ | 源商品采集 | | ☐ |
| SKU商品规格图 | image | ❌ | 源商品采集 | | ☐ |
| 价格 | input | ✅ | 手动输入 | | ☐ |
| 数量/库存 | input | ✅ | 手动输入 | | ☐ |
| SKU分类 | singleCheck | ⚠️ | 手动选择 | 部分类目必填 | ☐ |
| 是否上架 | boolean | ✅ | 默认配置 | 默认开启 | ☐ |
| 产品条形码 | input | ✅ | 手动输入 / OCR | | ☐ |
| 品名 | input | ✅ | 源商品采集 | | ☐ |
| 包装规格 | input | ✅ | 源商品采集 | | ☐ |
| 单件净含量 | input | ✅ | 源商品采集 | | ☐ |
| 总净含量 | input | ✅ | 源商品采集 | | ☐ |
| 口味（类目特有） | singleCheck | ❌ | 源商品采集 + 匹配 | | ☐ |
| 商家编码 | input | ❌ | 外部数据源 | 同步到ERP/仓库 | ☐ |

#### 5.2.5 销售信息 - 其他

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 一口价 | input | ✅ | 手动输入 | = SKU最低价 | ☐ |
| 商品数量 | input | ✅ | 手动输入 | = SKU库存总和 | ☐ |
| 商家编码 | input | ❌ | 外部数据源 | | ☐ |
| 上架时间 | singleCheck | ✅ | 默认配置 | 立刻/定时/仓库 | ☐ |
| 商品预检 | boolean | ❌ | 默认配置 | | ☐ |
| 库存扣减方式 | singleCheck | ✅ | 默认配置 | 拍下减/付款减 | ☐ |
| 多件优惠 | complex | ❌ | 默认配置 | | ☐ |

#### 5.2.6 物流与售后

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 发货地（省市） | singleCheck | ✅ | 类目模板 | | ☐ |
| 发货时效 | singleCheck | ✅ | 类目模板 | | ☐ |
| 承诺发货(A+) | complex | ⚠️ | 类目模板 | 部分类目必填 | ☐ |
| 退换货承诺 | singleCheck | ✅ | 类目模板 | | ☐ |
| 运费模板 | singleCheck | ✅ | 类目模板 | 模板ID | ☐ |
| 物流方式 | multiCheck | ✅ | 类目模板 | | ☐ |

### 5.3 外部数据源机制

#### 5.3.1 概述

用户可在钉钉/飞书表格中提前维护商品关联信息，系统通过**源商品链接**精确匹配，自动填充字段。

```
用户维护钉钉表格：
┌─────────────────────────────────────────────────────────────┐
│ 链接(B)        │ 产品简称    │ 商家编码 │ 有机编码    │ 厂家   │
├─────────────────────────────────────────────────────────────┤
│ https://tb.xx  │ 有机白沙花生 │ SKU001   │ 2490P18... │ 辽宁xx │
│ https://tb.xx  │ 有机鹰嘴豆   │ SKU002   │ 1340P25... │ 哈尔滨xx│
└─────────────────────────────────────────────────────────────┘
```

#### 5.3.2 匹配流程

```
上架流程：
    ↓
1. 用户输入源商品链接
    ↓
2. 系统并行执行：
   ├── 采集源商品页面信息
   └── 用链接匹配外部数据源 → 获取关联字段
    ↓
3. 合并数据 → 展示确认
```

#### 5.3.3 支持的数据源

| 数据源类型 | 授权方式 | 说明 |
|-----------|---------|------|
| 钉钉多维表格 | OAuth | 需用户在钉钉中确认授权 |
| 飞书多维表格 | OAuth | 需用户在飞书中确认授权 |
| Excel/CSV | 文件上传 | 上传本地文件 |

#### 5.3.4 可导入的字段

| 字段 | 业务用途 | 数据流向 |
|------|---------|---------|
| 商家编码 | 商品/SKU唯一标识 | 淘宝 → 聚水潭ERP → 仓库发货 |
| 有机编码（证书编号） | 有机认证标识 | 上架必填（有机类目） |
| 厂家 | 生产厂家信息 | 食品安全字段 |
| 有机证书图片 | 加工证书/种植证书 | 资质展示 |
| 检测报告 | 质检报告 | 资质展示 |

### 5.4 类目模板机制

#### 5.4.1 概述

从店铺已有商品中学习配置，作为同类目新商品的默认值。

#### 5.4.2 模板包含字段

| 字段类型 | 字段示例 | 说明 |
|---------|---------|------|
| 物流配置 | 发货地、物流模板、发货时间 | 店铺通用配置 |
| 售后配置 | 退换货承诺、运费险 | 店铺通用配置 |
| 上架配置 | 上架方式、库存扣减方式 | 店铺通用配置 |
| 类目特有 | 厂名、生产许可证等（食品类） | 同类目可复用 |

#### 5.4.3 模板匹配规则

```
上架新商品时：
    ↓
1. 检查目标类目是否有对应模板
    ├── 有 → 使用类目模板
    └── 无 → 使用通用默认模板
    ↓
2. 填充模板字段
    ↓
3. 用户可在确认页修改
```

### 5.5 AI生成能力

| 生成类型 | 输入 | 输出 | 场景 |
|---------|------|------|------|
| 白底图 | 任意主图 | 去背景白底图 | 天猫强制要求 |
| 3:4图 | 1:1主图 | 智能裁剪/扩展 | 部分类目要求 |
| 卖点提炼 | 详情/标题 | 商品卖点文案 | 可选增强 |

---

## 6. 评价体系

> 继承自 PRD v1.4，此处不重复。

---

## 7. 优化回路（简化）

### 6.1 API 方案下的优化回路

由于使用 Open API，不再需要：
- ~~codegen 录制~~
- ~~选择器维护~~
- ~~页面变化适配~~

保留的优化机制：

| 机制 | 说明 |
|------|------|
| **字段匹配规则优化** | 记录用户的手动调整，优化自动匹配算法 |
| **默认值学习** | 记录用户常用的默认值，下次自动填充 |
| **错误处理沉淀** | 记录 API 错误及解决方案 |

### 6.2 匹配规则学习

```
用户手动调整匹配
        ↓
记录调整：源字段 A ←→ Schema 字段 B
        ↓
下次同类商品自动应用此匹配规则
```

---

## 7. 交互设计（Web GUI）

### 7.1 设计原则

| 原则 | 说明 |
|------|------|
| **简洁直观** | 主流程一目了然：输入链接 → 匹配确认 → 一键上架 |
| **透明可控** | 字段匹配结果完全透明，用户可确认/调整 |
| **状态可见** | 连接状态、任务进度实时展示 |
| **配置可视** | 所有配置项使用下拉/开关，无需记忆 |

### 7.2 页面布局

#### 主界面

```
┌─────────────────────────────────────────────────────────────────────┐
│  [Logo] 商品搬运工具           [连接店铺]   历史  设置  帮助        │
├─────────────────────────────────────────────────────────────────────┤
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                       │
│  │ 12     │ │ 10     │ │ 2      │ │ 156    │                       │
│  │今日搬运│ │上架成功│ │待处理  │ │本月搬运│                       │
│  └────────┘ └────────┘ └────────┘ └────────┘                       │
├───────────────────────────────┬─────────────────────────────────────┤
│                               │                                     │
│  商品链接                      │  上架配置                           │
│  ─────────────────────        │  ─────────────────────              │
│                               │                                     │
│  [单个链接] [批量导入]         │  ⚠ 尚未连接店铺                     │
│                               │    请先点击右上角"连接店铺"         │
│  ┌─────────────────────────┐  │                                     │
│  │ 请输入商品链接...    🔍 │  │  目标类目: [选择类目 ▼]             │
│  └─────────────────────────┘  │                                     │
│                               │  定价策略: [使用原价 ▼]              │
│  支持: 淘宝 天猫 1688 拼多多  │                                     │
│                               │  ☑ 下载商品图片                     │
│  ┌─────────────────────────┐  │                                     │
│  │                         │  │  ☑ 自动发布商品                     │
│  │    等待商品信息         │  │                                     │
│  │                         │  │  ┌─────────────────────────────┐    │
│  └─────────────────────────┘  │  │      下一步：匹配确认       │    │
│                               │  └─────────────────────────────┘    │
└───────────────────────────────┴─────────────────────────────────────┘
```

### 7.3 核心流程

```
┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 1：输入商品链接                                                 │
│         粘贴链接 → 点击解析 → 展示商品预览                          │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 2：选择目标类目                                                 │
│         选择要发布到的店铺类目                                       │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 3：字段匹配确认（核心步骤）                                     │
│         系统自动匹配 → 展示表格 → 用户确认/调整                     │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 步骤 4：提交上架                                                     │
│         确认无误 → 点击上架 → 等待完成                              │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.4 字段匹配确认页面（核心）

#### 页面布局

```
┌──────────────────────────────────────────────────────────────────────────────────────┐
│  ← 返回                    字段匹配确认                              [全部展开]      │
├──────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                      │
│  商品预览                                                                            │
│  ┌────────────────────────────────────────────────────────────────────────────────┐ │
│  │ [主图]  有机燕麦片 500g 即食早餐无糖...                                        │ │
│  │         源店铺：xxx旗舰店  |  价格：¥29.9  |  SKU：3个                         │ │
│  └────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│  目标类目：食品 > 粮油米面 > 燕麦片                                                 │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐ │
│  │ Schema字段    │ 类型        │ 必填 │ 匹配来源      │ 预览值           │ 操作   │ │
│  ├───────────────┼─────────────┼──────┼───────────────┼──────────────────┼────────┤ │
│  │ ✓ 商品标题    │ 文本        │ ✓   │ 源标题        │ 有机燕麦片500g...│ [编辑] │ │
│  │ ✓ 一口价      │ 文本        │ ✓   │ 源价格        │ 29.9             │ [编辑] │ │
│  │ ✓ 主图        │ 图片        │ ✓   │ 源主图(5张)   │ [预览]           │ [管理] │ │
│  │ ✓ 商品描述    │ 富文本      │ ✓   │ 源详情        │ [预览]           │ [编辑] │ │
│  │ ⚠ 品牌        │ 单选        │ ✓   │ 未匹配        │ -                │ [选择] │ │
│  │ ⚠ 货号        │ 文本        │ ✓   │ 未匹配        │ -                │ [填写] │ │
│  │ ○ 产地        │ 文本        │     │ 源产地        │ 浙江杭州         │ [编辑] │ │
│  │ ○ 保质期      │ 文本        │     │ 源保质期      │ 365天            │ [编辑] │ │
│  │ ○ 净含量      │ 文本        │     │ 源规格        │ 500g             │ [编辑] │ │
│  │ ○ 包装方式    │ 单选        │     │ 未匹配        │ -                │ [选择] │ │
│  └────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│  图例：✓ 已匹配   ⚠ 需处理（必填未匹配）   ○ 可选                                   │
│                                                                                      │
│  ┌────────────────────────────────────────────────────────────────────────────────┐ │
│  │  统计：必填字段 6 个（已匹配 4 个，待处理 2 个）| 可选字段 12 个               │ │
│  └────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                      │
│                                              [返回修改]  [确认上架]                  │
│                                                                                      │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

#### 状态说明

| 状态 | 图标 | 说明 | 用户操作 |
|------|------|------|----------|
| **已匹配** | ✓ | 自动匹配成功，已有值 | 可编辑调整 |
| **需处理** | ⚠ | 必填字段但未匹配到值 | **必须**填写/选择 |
| **可选** | ○ | 非必填字段 | 可跳过或填写 |

#### 字段类型与操作

| 类型 | 操作方式 |
|------|----------|
| 文本 | 弹出文本框编辑 |
| 单选 | 弹出下拉选择（从 Schema options 中选） |
| 多选 | 弹出多选框 |
| 图片 | 弹出图片管理（预览/删除/添加/排序） |
| 富文本 | 弹出富文本编辑器 |
| 复合 | 展开子表格编辑 |

### 7.5 连接店铺流程

```
┌─────────────────────────────────────────────────────────────────────┐
│ 点击"连接店铺"                                                      │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 弹出窗口，跳转淘宝 OAuth 授权页                                      │
│                                                                     │
│ - 用户登录淘宝账号                                                  │
│ - 确认授权                                                          │
└─────────────────────────────────────────────────────────────────────┘
                                ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 授权成功，获取 access_token                                         │
│                                                                     │
│ - 页面显示：已连接 [店铺名称]                                       │
│ - Token 有效期：通常 24 小时，支持刷新                              │
└─────────────────────────────────────────────────────────────────────┘
```

#### 连接状态 UI

| 状态 | 顶部按钮 | 说明 |
|------|----------|------|
| 未连接 | [连接店铺] (橙色) | 提示用户先连接 |
| 连接中 | [连接中...] (禁用) | 等待授权完成 |
| 已连接 | [店铺名 ✓] (绿色) | 显示店铺名称 |
| 过期 | [重新连接] (橙色) | Token 过期，需重新授权 |

### 7.6 上架进度与结果

#### 上架进度弹窗

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│  正在上架商品...                                                    │
│                                                                     │
│  ✓ 上传图片 (5/5)                                                  │
│  ✓ 匹配产品                                                        │
│  ⏳ 提交商品信息...                                                │
│  ○ 完成                                                            │
│                                                                     │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 75%                            │
│                                                                     │
│                                              [取消]                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 上架成功

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│                          ✓ 上架成功！                               │
│                                                                     │
│  商品ID：625438790123                                               │
│  商品标题：有机燕麦片 500g 即食早餐无糖...                          │
│                                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
│  │ 查看商品    │  │ 继续上架    │  │ 返回首页    │                 │
│  └─────────────┘  └─────────────┘  └─────────────┘                 │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 上架失败

```
┌─────────────────────────────────────────────────────────────────────┐
│                                                                     │
│                          ❌ 上架失败                                │
│                                                                     │
│  错误信息：品牌字段值不在可选范围内                                 │
│  错误码：isv.invalid-parameter:prop_20000                           │
│                                                                     │
│  ┌─────────────┐  ┌─────────────┐                                  │
│  │ 返回修改    │  │ 查看帮助    │                                  │
│  └─────────────┘  └─────────────┘                                  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 7.7 设置页面

```
设置
├── 基础配置
│   ├── 默认定价策略
│   ├── 默认发布状态（上架/仓库）
│   └── 下载图片开关
│
├── 店铺管理
│   ├── 已连接店铺列表
│   ├── 添加店铺
│   └── Token 状态
│
├── 字段默认值
│   ├── 常用字段默认值设置
│   └── 按类目设置默认值
│
└── 高级设置
    ├── API 配置（App Key 等）
    └── 日志级别
```

### 7.8 技术架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                           用户浏览器                                 │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                     Web GUI (前端)                             │ │
│  │                     - React / Vue                              │ │
│  │                     - 本地运行 (localhost:3000)                │ │
│  └───────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
                                ↕ HTTP API
┌─────────────────────────────────────────────────────────────────────┐
│                          本地后端服务                                │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                     API Server (Python)                        │ │
│  │                     - FastAPI                                  │ │
│  │                     - 本地运行 (localhost:8000)                │ │
│  └───────────────────────────────────────────────────────────────┘ │
│                                ↕                                    │
│  ┌───────────────────────────────────────────────────────────────┐ │
│  │                     淘宝 Open API                              │ │
│  │                     - OAuth 授权                               │ │
│  │                     - Schema API 调用                          │ │
│  │                     - 图片上传                                 │ │
│  └───────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 8. 数据设计（更新）

### 核心数据实体

| 实体 | 用途 | 关键字段 |
|------|------|----------|
| **店铺授权** | OAuth Token 管理 | shop_id, access_token, refresh_token, expires_at |
| **采集商品** | 源商品数据 | source_url, title, price, images, skus, description |
| **Schema 缓存** | 类目规则缓存 | category_id, schema_xml, updated_at |
| **字段匹配记录** | 匹配规则学习 | source_field, schema_field_id, category_id |
| **上架记录** | 追踪上架结果 | item_id, source_url, status, created_at |

### 数据关系

```
店铺授权 ──1:N──→ 上架记录
                    ↓
采集商品 ──1:1──→ 上架记录
                    ↓
Schema缓存 ←── 字段匹配记录
```

---

## 9. 异常与兜底（更新）

### API 错误处理

| 错误类型 | 处理策略 |
|----------|----------|
| Token 过期 | 自动刷新 Token，失败则提示重新授权 |
| 参数校验失败 | 高亮错误字段，提示用户修改 |
| 类目不支持 | 提示用户选择其他类目 |
| 图片上传失败 | 自动重试 3 次，失败则提示 |
| 网络超时 | 自动重试，失败则提示 |
| API 限流 | 等待后重试 |

### 兜底原则

| 原则 | 说明 |
|------|------|
| **数据不丢失** | 采集数据、匹配结果本地保存 |
| **可恢复** | 失败后可从字段匹配步骤继续 |
| **错误可理解** | API 错误翻译成用户能理解的提示 |

---

## 10. 开放问题（更新）

### 待后续明确

| # | 问题 | 说明 | 何时解决 |
|---|------|------|----------|
| 1 | 开放平台资质 | 需要申请淘宝开放平台 ISV 资质 | 研发前 |
| 2 | 前端技术选型 | React vs Vue | 研发阶段 |
| 3 | 商品采集方式 | 爬虫 vs 淘宝 API | 研发阶段 |
| 4 | 淘宝 vs 天猫 API 差异 | 两个平台的 Schema API 是否一致 | 研发阶段 |

### MVP 边界

| 范围 | MVP 包含 | 后续迭代 |
|------|----------|----------|
| 商品来源 | 淘宝/天猫 | 1688、拼多多 |
| 目标店铺 | 单店铺 | 多店铺 |
| 类目 | 食品类目 | 其他类目 |
| 操作模式 | 单品 | 批量 |

---

## 更新记录

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| v1 | 2026-01-29 | 初始版本（CLI + 浏览器模拟） |
| v1.1 | 2026-01-30 | 补充 codegen 交互设计 |
| v1.2 | 2026-01-30 | 新增学习驱动初始化设计 |
| v1.3 | 2026-01-30 | 新增概览章节 |
| v1.4 | 2026-01-30 | 完善 CLI 交互设计 |
| **v2.0** | **2026-01-31** | **重大变更：Open API + Web GUI + 字段匹配确认** |
