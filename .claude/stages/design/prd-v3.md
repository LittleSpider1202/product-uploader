# 淘宝商品一键上架工具 PRD v3

---

## 概览

### 文档信息

| 项目 | 内容 |
|------|------|
| 版本 | v3.0 |
| 状态 | 进行中 |
| 更新日期 | 2026-02-01 |

### 目录结构

| # | 章节 | 概要 |
|---|------|------|
| 1-3 | 背景/用户/范围 | 继承 v1，手动上架效率低，目标单品 <5 分钟 |
| 4 | 系统解构 | Open API 方案替代浏览器模拟 |
| 5 | **字段清单** | **v3新增**：完整字段与来源映射、外部数据源、类目模板 |
| 6 | 评价体系 | 继承 v1 |
| 7 | 优化回路 | 简化，API 方案无需 codegen 录制 |
| 8 | **交互设计** | **v3重写**：首次引导 + 5步上架流程 + 设置页面 |
| 9 | 数据设计 | 更新，适配 Schema 体系 + 外部数据源 |
| 10 | 异常与兜底 | 更新，API 错误处理 |
| 11 | 开放问题 | 更新 |

### v2.0 重大变更

| 变更项 | v1.x | v2.0 |
|--------|------|------|
| **技术方案** | 浏览器模拟（Playwright） | **淘宝 Open API** |
| **交互形式** | CLI 命令行 | **Web GUI 可视化界面** |
| **字段处理** | 学习模式 + 字段绑定 | **Schema 自动解析 + 人工确认** |
| **登录方式** | 扫码/Cookie | **OAuth 授权** |
| **稳定性** | 低（页面变化就失效） | **高（官方接口）** |

### v3.0 核心变更

| 变更项 | 说明 |
|--------|------|
| **字段清单** | 新增完整字段与来源映射表（第5节） |
| **外部数据源** | 支持钉钉/飞书表格，按链接精确匹配 |
| **类目模板** | 从店铺已有商品学习配置 |
| **引导流程** | 首次用户引导配置流程（店铺授权→数据源→模板） |
| **交互设计** | 完整重新设计页面结构和5步上架流程 |

---

## 1-3 节：继承 v1.4 版本

> 第 1-3 节内容继承自 PRD v1.4，此处不重复。请参阅 `prd-v1.md`。

---

## 4. 系统解构（重大变更）

### 4.1 技术方案对比

| 对比项 | 浏览器模拟方案 | Open API 方案 |
|--------|---------------|---------------|
| 登录方式 | 扫码/Cookie | OAuth 授权 |
| 商品发布 | 模拟填表单 | 调用 Schema API |
| 字段处理 | 需要学习/绑定选择器 | 自动解析 Schema |
| 图片上传 | 模拟上传操作 | taobao.picture.upload |
| 稳定性 | 低（页面变化就失效） | 高（官方接口） |
| 维护成本 | 高（选择器维护） | 低 |
| 准入门槛 | 无 | 需要开放平台资质 |

**决策：采用 Open API 方案**

### 4.2 核心 API 调用链

```
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 0：OAuth 授权（一次性）                                         │
│                                                                     │
│   用户点击"连接店铺" → 跳转淘宝授权页 → 获取 access_token           │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 1：采集源商品数据                                               │
│                                                                     │
│   输入商品链接 → 爬取页面 → 提取商品信息                            │
│   （标题、价格、图片、SKU、描述等）                                  │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 2：上传图片                                                     │
│                                                                     │
│   taobao.picture.upload                                             │
│   → 返回图片 URL                                                    │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 3：获取发布规则 Schema                                          │
│                                                                     │
│   3.1 tmall.product.match.schema.get(category_id)                   │
│       → 获取产品匹配规则                                            │
│                                                                     │
│   3.2 tmall.product.schema.match(xml_data)                          │
│       → 匹配成功：获得 product_id                                   │
│       → 匹配失败：调用 tmall.product.add.schema.get 发布产品        │
│                                                                     │
│   3.3 tmall.item.add.schema.get(category_id, product_id)            │
│       → 获取商品发布规则 Schema                                     │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 4：字段匹配 + 人工确认                                          │
│                                                                     │
│   4.1 系统自动匹配：采集数据字段 ←→ Schema 字段                     │
│   4.2 展示匹配表格，用户确认/调整                                   │
│   4.3 用户填写未匹配的必填字段                                      │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 阶段 5：提交发布                                                     │
│                                                                     │
│   tmall.item.schema.add(category_id, product_id, xml_data)          │
│   → 返回 item_id（商品ID）                                          │
└─────────────────────────────────────────────────────────────────────┘
```

### 4.3 Schema 体系说明

#### Schema 结构

Schema 是一个 XML 文档，由多个 `field` 组成，每个 field 描述一个字段规则：

| 属性 | 说明 |
|------|------|
| **id** | 字段唯一标识，如 `title`、`price` |
| **name** | 显示名称，如 "商品标题" |
| **type** | 输入类型 |
| **rules** | 校验规则（如必填、长度限制） |
| **options** | 可选值（用于单选/多选类型） |
| **default-value** | 默认值 |

#### Field 类型

| Schema Type | 中文 | 说明 |
|-------------|------|------|
| input | 文本 | 单行文本输入 |
| multiInput | 多值文本 | 多个文本值 |
| singleCheck | 单选 | 单选下拉 |
| multiCheck | 多选 | 多选复选框 |
| complex | 复合 | 嵌套结构 |
| multiComplex | 多项复合 | 数组嵌套结构 |
| label | 标签 | 只读展示 |

#### Schema 示例

**获取到的规则 Schema：**
```xml
<itemRule>
  <field id="title" name="商品标题" type="input">
    <rules>
      <rule name="requiredRule" value="true"/>
      <rule name="maxLengthRule" value="60"/>
    </rules>
  </field>
  <field id="prop_20000" name="品牌" type="singleCheck">
    <options>
      <option displayName="Nike" value="10000497"/>
      <option displayName="Adidas" value="10000498"/>
    </options>
  </field>
</itemRule>
```

**填充数据后提交的 XML：**
```xml
<itemRule>
  <field id="title" name="商品标题" type="input">
    <value>有机燕麦片 500g 即食早餐</value>
  </field>
  <field id="prop_20000" name="品牌" type="singleCheck">
    <value>10000497</value>
  </field>
</itemRule>
```

---

## 5. 字段清单与来源映射（新增）

### 5.1 字段来源分类

| 来源类型 | 说明 | 示例字段 |
|---------|------|---------|
| **源商品采集** | 从源商品页面抓取 | 标题、主图、详情、SKU规格 |
| **外部数据源** | 钉钉/飞书表格，按链接匹配 | 商家编码、有机编码、厂家、证书 |
| **类目模板** | 从店铺已有商品学习 | 物流、售后、发货地、厂家信息 |
| **AI生成** | 自动生成 | 白底图、3:4图 |
| **手动输入** | 每次必须人工填写 | 价格、库存 |

### 5.2 完整字段清单

> 注：必填列中 ✅=必填，⚠️=部分类目必填，❌=可选；已确认列待实际调用API后逐个确认。

#### 5.2.1 图文描述

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 1:1主图（5张） | image | ✅ | 源商品采集 | 至少1张 | ☐ |
| 3:4主图（5张） | image | ⚠️ | 源商品采集 / AI生成 | 部分类目必填 | ☐ |
| 白底图 | image | ⚠️ | AI生成 | 天猫通常必填 | ☐ |
| 商品视频 | video | ❌ | 源商品采集 | 可选 | ☐ |
| 商品卖点 | input | ❌ | 源商品采集 / AI生成 | 可选 | ☐ |
| PC详情 | richText | ✅ | 源商品采集 | | ☐ |
| 无线详情 | richText | ❌ | 源商品采集 | 可选 | ☐ |

#### 5.2.2 基础信息

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 商品标题 | input | ✅ | 源商品采集 | 需人工确认 | ☐ |
| 商品类目 | 类目ID | ✅ | 人工选择 | 源类目→目标类目映射 | ☐ |
| 商品品类 | singleCheck | ✅ | 类目Schema | 选类目后确定 | ☐ |
| 品牌 | singleCheck | ✅ | 源商品采集 + 匹配 | 需映射到目标品牌库 | ☐ |
| 系列 | singleCheck | ⚠️ | 源商品采集 + 匹配 | 部分类目必填 | ☐ |
| 规格 | input | ⚠️ | 源商品采集 | 部分类目必填 | ☐ |
| 货号 | input | ⚠️ | 源商品采集 / 手动 | 部分类目必填 | ☐ |

#### 5.2.3 食品安全（类目特有）

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 外包装类型 | singleCheck | ✅ | 类目模板 / 手动 | | ☐ |
| 组分表 | multiComplex | ❌ | 源商品采集 / 手动 | 营养成分 | ☐ |
| 生产许可证编号 | input | ✅ | 类目模板 | 同厂家可复用 | ☐ |
| 产品标准号 | input | ✅ | 类目模板 | | ☐ |
| 厂名 | input | ✅ | 外部数据源 / 类目模板 | | ☐ |
| 厂家联系方式 | input | ✅ | 类目模板 | | ☐ |
| 配料表 | input | ✅ | 源商品采集 | | ☐ |
| 保质期 | input | ✅ | 源商品采集 | | ☐ |
| 储藏方法 | input | ✅ | 源商品采集 | | ☐ |
| 食品添加剂 | input | ❌ | 源商品采集 | | ☐ |
| 有机编码 | input | ⚠️ | 外部数据源 | 有机食品必填 | ☐ |
| 有机证书图片 | image | ⚠️ | 外部数据源 | 有机食品必填 | ☐ |
| 条形码 | input | ✅ | 手动输入 / OCR | | ☐ |

#### 5.2.4 销售信息 - SKU

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| SKU规格名称 | input | ✅ | 源商品采集 | 如"有机黑芝麻600g" | ☐ |
| SKU搜索主图 | image | ❌ | 源商品采集 | | ☐ |
| SKU商品规格图 | image | ❌ | 源商品采集 | | ☐ |
| 价格 | input | ✅ | 手动输入 | | ☐ |
| 数量/库存 | input | ✅ | 手动输入 | | ☐ |
| SKU分类 | singleCheck | ⚠️ | 手动选择 | 部分类目必填 | ☐ |
| 是否上架 | boolean | ✅ | 默认配置 | 默认开启 | ☐ |
| 产品条形码 | input | ✅ | 手动输入 / OCR | | ☐ |
| 品名 | input | ✅ | 源商品采集 | | ☐ |
| 包装规格 | input | ✅ | 源商品采集 | | ☐ |
| 单件净含量 | input | ✅ | 源商品采集 | | ☐ |
| 总净含量 | input | ✅ | 源商品采集 | | ☐ |
| 口味（类目特有） | singleCheck | ❌ | 源商品采集 + 匹配 | | ☐ |
| 商家编码 | input | ❌ | 外部数据源 | 同步到ERP/仓库 | ☐ |

#### 5.2.5 销售信息 - 其他

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 一口价 | input | ✅ | 手动输入 | = SKU最低价 | ☐ |
| 商品数量 | input | ✅ | 手动输入 | = SKU库存总和 | ☐ |
| 商家编码 | input | ❌ | 外部数据源 | | ☐ |
| 上架时间 | singleCheck | ✅ | 默认配置 | 立刻/定时/仓库 | ☐ |
| 商品预检 | boolean | ❌ | 默认配置 | | ☐ |
| 库存扣减方式 | singleCheck | ✅ | 默认配置 | 拍下减/付款减 | ☐ |
| 多件优惠 | complex | ❌ | 默认配置 | | ☐ |

#### 5.2.6 物流与售后

| 页面字段 | Schema类型 | 必填 | 来源 | 备注 | 已确认 |
|---------|-----------|:----:|------|------|:------:|
| 发货地（省市） | singleCheck | ✅ | 类目模板 | | ☐ |
| 发货时效 | singleCheck | ✅ | 类目模板 | | ☐ |
| 承诺发货(A+) | complex | ⚠️ | 类目模板 | 部分类目必填 | ☐ |
| 退换货承诺 | singleCheck | ✅ | 类目模板 | | ☐ |
| 运费模板 | singleCheck | ✅ | 类目模板 | 模板ID | ☐ |
| 物流方式 | multiCheck | ✅ | 类目模板 | | ☐ |

### 5.3 外部数据源机制

#### 5.3.1 概述

用户可在钉钉/飞书表格中提前维护商品关联信息，系统通过**源商品链接**精确匹配，自动填充字段。

```
用户维护钉钉表格：
┌─────────────────────────────────────────────────────────────┐
│ 链接(B)        │ 产品简称    │ 商家编码 │ 有机编码    │ 厂家   │
├─────────────────────────────────────────────────────────────┤
│ https://tb.xx  │ 有机白沙花生 │ SKU001   │ 2490P18... │ 辽宁xx │
│ https://tb.xx  │ 有机鹰嘴豆   │ SKU002   │ 1340P25... │ 哈尔滨xx│
└─────────────────────────────────────────────────────────────┘
```

#### 5.3.2 匹配流程

```
上架流程：
    ↓
1. 用户输入源商品链接
    ↓
2. 系统并行执行：
   ├── 采集源商品页面信息
   └── 用链接匹配外部数据源 → 获取关联字段
    ↓
3. 合并数据 → 展示确认
```

#### 5.3.3 支持的数据源

| 数据源类型 | 授权方式 | 说明 |
|-----------|---------|------|
| 钉钉多维表格 | OAuth | 需用户在钉钉中确认授权 |
| 飞书多维表格 | OAuth | 需用户在飞书中确认授权 |
| Excel/CSV | 文件上传 | 上传本地文件 |

#### 5.3.4 可导入的字段

| 字段 | 业务用途 | 数据流向 |
|------|---------|---------|
| 商家编码 | 商品/SKU唯一标识 | 淘宝 → 聚水潭ERP → 仓库发货 |
| 有机编码（证书编号） | 有机认证标识 | 上架必填（有机类目） |
| 厂家 | 生产厂家信息 | 食品安全字段 |
| 有机证书图片 | 加工证书/种植证书 | 资质展示 |
| 检测报告 | 质检报告 | 资质展示 |

### 5.4 类目模板机制

#### 5.4.1 概述

从店铺已有商品中学习配置，作为同类目新商品的默认值。

#### 5.4.2 模板包含字段

| 字段类型 | 字段示例 | 说明 |
|---------|---------|------|
| 物流配置 | 发货地、物流模板、发货时间 | 店铺通用配置 |
| 售后配置 | 退换货承诺、运费险 | 店铺通用配置 |
| 上架配置 | 上架方式、库存扣减方式 | 店铺通用配置 |
| 类目特有 | 厂名、生产许可证等（食品类） | 同类目可复用 |

#### 5.4.3 模板匹配规则

```
上架新商品时：
    ↓
1. 检查目标类目是否有对应模板
    ├── 有 → 使用类目模板
    └── 无 → 使用通用默认模板
    ↓
2. 填充模板字段
    ↓
3. 用户可在确认页修改
```

### 5.5 AI生成能力

| 生成类型 | 输入 | 输出 | 场景 |
|---------|------|------|------|
| 白底图 | 任意主图 | 去背景白底图 | 天猫强制要求 |
| 3:4图 | 1:1主图 | 智能裁剪/扩展 | 部分类目要求 |
| 卖点提炼 | 详情/标题 | 商品卖点文案 | 可选增强 |

---

## 6. 评价体系

> 继承自 PRD v1.4，此处不重复。

---

## 7. 优化回路（简化）

### 7.1 API 方案下的优化回路

由于使用 Open API，不再需要：
- ~~codegen 录制~~
- ~~选择器维护~~
- ~~页面变化适配~~

保留的优化机制：

| 机制 | 说明 |
|------|------|
| **字段匹配规则优化** | 记录用户的手动调整，优化自动匹配算法 |
| **默认值学习** | 记录用户常用的默认值，下次自动填充 |
| **错误处理沉淀** | 记录 API 错误及解决方案 |

### 7.2 匹配规则学习

```
用户手动调整匹配
        ↓
记录调整：源字段 A ←→ Schema 字段 B
        ↓
下次同类商品自动应用此匹配规则
```

---

## 8. 交互设计（Web GUI）

### 8.1 设计原则

| 原则 | 说明 |
|------|------|
| **渐进式引导** | 首次用户有完整引导流程，配置完成后进入常规使用 |
| **简洁直观** | 主流程一目了然：输入链接 → 匹配确认 → 一键上架 |
| **透明可控** | 字段匹配结果完全透明，用户可确认/调整 |
| **状态可见** | 连接状态、配置状态、任务进度实时展示 |

### 8.2 系统页面结构

```
┌─────────────────────────────────────────────────────────┐
│  淘宝商品一键上架工具                                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│  │ 首页  │ │ 上架  │ │ 记录  │ │ 模板  │ │ 设置  │          │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

| 页面 | 功能 |
|------|------|
| 首页 | 数据概览、快捷入口、配置状态 |
| 上架 | 核心流程：采集→填写→提交（5步） |
| 记录 | 上架历史、状态追踪 |
| 模板 | 类目模板管理 |
| 设置 | 店铺授权、数据源配置 |

### 8.3 用户状态分析

```
用户进入系统
      ↓
  检查状态
      ↓
┌─────────────────────────────────────────┐
│ 状态1：全新用户                          │
│   • 无店铺授权                           │
│   • 无数据源配置                         │
│   • 无类目模板                           │
│   → 进入引导流程                         │
├─────────────────────────────────────────┤
│ 状态2：配置不完整                        │
│   • 有店铺授权，但无数据源               │
│   → 提示补充配置                         │
├─────────────────────────────────────────┤
│ 状态3：配置完整                          │
│   • 有店铺授权                           │
│   • 有数据源（可选）                     │
│   → 进入正常使用流程                     │
└─────────────────────────────────────────┘
```

### 8.4 首次使用引导流程

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 1.欢迎页 │ → │2.店铺授权│ → │3.数据源  │ → │4.类目模板│ → 完成
└─────────┘    └─────────┘    └─────────┘    └─────────┘
                  必须           可跳过         可跳过
```

#### 引导页1：欢迎页

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│                    欢迎使用                              │
│              淘宝商品一键上架工具                         │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  只需 3 步，即可开始使用：                                │
│                                                         │
│  ┌─────┐     ┌─────┐     ┌─────┐                       │
│  │  1  │ ──→ │  2  │ ──→ │  3  │                       │
│  └─────┘     └─────┘     └─────┘                       │
│  授权店铺    配置数据源   创建模板                        │
│  (必须)      (推荐)      (推荐)                         │
│                                                         │
│                                                         │
│                      [开始配置 →]                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 引导页2：店铺授权（必须）

```
┌─────────────────────────────────────────────────────────┐
│ 初始配置                              步骤 1/3 · 店铺授权 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  授权您的天猫/淘宝店铺                                    │
│                                                         │
│  授权后可以：                                            │
│  • 获取店铺类目和品牌信息                                │
│  • 上传商品图片到图片空间                                │
│  • 发布商品到店铺                                        │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │                                                 │   │
│  │         [授权天猫/淘宝店铺]                      │   │
│  │                                                 │   │
│  │         点击后将跳转到淘宝登录页面                │   │
│  │                                                 │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ⚠️ 这是必须步骤，授权后才能使用上架功能                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

授权成功后：

```
┌─────────────────────────────────────────────────────────┐
│ 初始配置                              步骤 1/3 · 店铺授权 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ✅ 授权成功！                                           │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 九月的诗旗舰店                                    │   │
│  │    店铺类型：天猫旗舰店                          │   │
│  │    授权有效期：2026-02-01 至 2027-02-01         │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  [+ 添加更多店铺]                                        │
│                                                         │
│                                          [下一步 →]     │
└─────────────────────────────────────────────────────────┘
```

#### 引导页3：数据源配置（推荐，可跳过）

```
┌─────────────────────────────────────────────────────────┐
│ 初始配置                              步骤 2/3 · 数据源  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  配置外部数据源（推荐）                                   │
│                                                         │
│  如果您在钉钉/飞书表格中维护了商品信息（如商家编码、      │
│  有机证书等），可以关联后自动匹配填充。                   │
│                                                         │
│  支持的数据源：                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │  钉钉表格     │  │  飞书表格     │  │  Excel上传   │  │
│  │              │  │              │  │              │  │
│  │   [配置]     │  │   [配置]     │  │   [上传]     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  💡 没有外部数据？可以跳过此步骤，后续手动填写字段        │
│                                                         │
│                              [跳过]    [下一步 →]       │
└─────────────────────────────────────────────────────────┘
```

选择钉钉表格后：

```
┌─────────────────────────────────────────────────────────┐
│ 配置钉钉表格                                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  步骤 1：授权钉钉                                        │
│  ┌─────────────────────────────────────────────────┐   │
│  │         [授权钉钉访问]                           │   │
│  │         需要您在钉钉中确认授权                    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  步骤 2：选择表格                                        │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 表格地址                                         │   │
│  │ [粘贴钉钉表格链接...                         ]   │   │
│  │                                                 │   │
│  │ 或从已授权表格中选择：                           │   │
│  │ ┌─────────────────────────────────────────┐    │   │
│  │ │ ○ 有机证书管理表                         │    │   │
│  │ │ ○ 商品编码表                            │    │   │
│  │ │ ○ 供应商信息表                          │    │   │
│  │ └─────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│                              [取消]    [下一步 →]       │
└─────────────────────────────────────────────────────────┘
```

配置字段映射：

```
┌─────────────────────────────────────────────────────────┐
│ 配置钉钉表格 - 字段映射                                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  已读取表格：有机证书管理表（89条记录）                    │
│                                                         │
│  ⚡ 匹配字段（用于关联商品）                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 表格列         │ 用途                           │   │
│  │ [B-链接    ▼]  │ 源商品链接（用于匹配）          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  📥 导入字段（匹配后自动填充）                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ☑ C-产品简称    →  产品名称                      │   │
│  │ ☑ D-证书编号    →  有机编码                      │   │
│  │ ☑ A-厂家        →  厂名                         │   │
│  │ ☑ E-有机加工证书截图  →  资质图片                 │   │
│  │ ☐ F-过期时间    →  （不导入）                    │   │
│  │ ☑ J-检测报告    →  检测报告                      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│                              [取消]    [保存配置]       │
└─────────────────────────────────────────────────────────┘
```

#### 引导页4：类目模板（推荐，可跳过）

```
┌─────────────────────────────────────────────────────────┐
│ 初始配置                              步骤 3/3 · 类目模板│
├─────────────────────────────────────────────────────────┤
│                                                         │
│  创建类目模板（推荐）                                     │
│                                                         │
│  从店铺已有商品中学习配置，后续上架同类目商品时自动套用    │
│  • 发货地、物流模板、售后承诺                            │
│  • 厂家信息、生产许可证                                  │
│  • 其他类目特有字段                                      │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  店铺商品（选择作为模板参考）：                           │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ☐ [图] 有机黑芝麻600g     类目：特色米/面粉/杂粮  │   │
│  │ ☐ [图] 有机核桃仁500g     类目：坚果/炒货         │   │
│  │ ☐ [图] 红薯粉条200g       类目：方便粉丝/米线     │   │
│  │ ...                                             │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  已选择：0 个商品                    [创建模板]          │
│                                                         │
│  💡 可以跳过，后续在"模板管理"中创建                      │
│                                                         │
│                              [跳过]    [完成配置]       │
└─────────────────────────────────────────────────────────┘
```

#### 引导完成页

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│                    配置完成！                            │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  ✅ 店铺授权：九月的诗旗舰店                              │
│  ✅ 数据源：钉钉表格 - 有机证书管理表（89条）             │
│  ✅ 类目模板：已创建 3 个                                │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  现在可以开始上架商品了！                                │
│                                                         │
│                      [开始上架]                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 8.5 常规使用 - 首页

```
┌─────────────────────────────────────────────────────────┐
│  淘宝商品一键上架工具                     [九月的诗旗舰店]│
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────┐  ┌─────────────────────────┐  │
│  │                     │  │ 数据概览                 │  │
│  │   [上架商品]         │  │                         │  │
│  │                     │  │ 今日上架：3 件           │  │
│  │   输入链接，开始上架  │  │ 本月上架：28 件          │  │
│  │                     │  │ 成功率：96%             │  │
│  └─────────────────────┘  └─────────────────────────┘  │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  ⚙️ 配置状态                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ✅ 店铺授权有效        │ 有效期至 2027-02-01      │   │
│  │ ✅ 数据源已配置        │ 钉钉表格 89条记录        │   │
│  │ ✅ 类目模板            │ 3 个模板                 │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  最近上架                                               │
│  ┌─────────────────────────────────────────────────┐   │
│  │ [图] 有机白沙花生780g   │ 10分钟前 │ ✅ 成功      │   │
│  │ [图] 有机鹰嘴豆950g     │ 1小时前  │ ✅ 成功      │   │
│  │ [图] 有机红芸豆500g     │ 2小时前  │ ⚠️ 待处理    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 8.6 核心上架流程（5步）

```
┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐
│ 1.输入链接│ → │ 2.选择类目│ → │ 3.确认字段│ → │ 4.编辑SKU│ → │ 5.提交上架│
└─────────┘    └─────────┘    └─────────┘    └─────────┘    └─────────┘
```

#### 步骤1：输入链接

```
┌─────────────────────────────────────────────────────────┐
│ 上架商品                                        步骤 1/5 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  源商品链接                                              │
│  ┌─────────────────────────────────────────┐ ┌────────┐│
│  │ https://item.taobao.com/item.htm?id=xxx │ │  采集  ││
│  └─────────────────────────────────────────┘ └────────┘│
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  📦 数据源匹配结果                                       │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ✅ 钉钉表格匹配成功                               │   │
│  │    • 商家编码：SKU001                            │   │
│  │    • 有机编码：2490P1800146                      │   │
│  │    • 厂家：辽宁绿色常兴农业发展有限公司            │   │
│  │    • 有机证书：已关联                            │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ⚠️ 未匹配到数据源？ [手动关联] [跳过]                   │
│                                                         │
│                                          [下一步 →]     │
└─────────────────────────────────────────────────────────┘
```

#### 步骤2：选择类目

```
┌─────────────────────────────────────────────────────────┐
│ 选择类目                                        步骤 2/5 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  源商品类目：食品 > 坚果 > 花生                          │
│                                                         │
│  目标类目：                                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
│  │粮油调味/速食 │→│ 米/面粉/杂粮 │→│ 特色米/面粉  │       │
│  │             │ │             │ │             │       │
│  │ 咖啡/麦片   │ │ 低温乳类    │ │ 豆类        │       │
│  │▶粮油调味    │ │ 调味品      │ │ 米类        │       │
│  │ 零食/坚果   │ │ 儿童速食    │ │▶特色米/面粉  │       │
│  │ 其他        │ │▶米/面粉/杂粮 │ │ 杂粮组合    │       │
│  └─────────────┘ └─────────────┘ └─────────────┘       │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  已有类目模板                                            │
│  ┌─────────────────────────────────────────────────┐   │
│  │ ✅ 特色米/面粉 模板（来源：有机黑芝麻600g）        │   │
│  │    包含：发货地、物流模板、售后承诺、厂家信息      │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│                              [← 上一步]  [下一步 →]     │
└─────────────────────────────────────────────────────────┘
```

#### 步骤3：确认字段

```
┌─────────────────────────────────────────────────────────┐
│ 确认字段                                        步骤 3/5 │
├─────────────────────────────────────────────────────────┤
│ 筛选：[全部] [待确认] [待填写] [已完成]                   │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 📷 图文描述                                              │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 字段        │ 值              │ 来源    │ 状态     │  │
│ ├───────────────────────────────────────────────────┤  │
│ │ 1:1主图(5)  │ [图][图][图]... │ 采集    │ ✅ 已完成 │  │
│ │ 3:4主图(5)  │ [空]            │ AI生成  │ 🔵 待生成 │  │
│ │ 白底图      │ [空]            │ AI生成  │ 🔵 待生成 │  │
│ │ 商品视频    │ [无]            │ 采集    │ ⚪ 可选   │  │
│ │ 详情描述    │ [预览]          │ 采集    │ ✅ 已完成 │  │
│ └───────────────────────────────────────────────────┘  │
│                                       [一键生成图片]    │
│                                                         │
│ 📝 基础信息                                              │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 商品标题    │ 有机黑芝麻600g  │ 采集    │ 🟡 待确认 │  │
│ │ 品牌        │ 九月的诗        │ 采集+匹配│ 🟡 待确认 │  │
│ │ 系列        │ 有机            │ 采集    │ ✅ 已完成 │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│ 🏭 食品安全（来源：类目模板 + 数据源）                    │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 厂名        │ 辽宁绿色常兴... │ 数据源  │ ✅ 已完成 │  │
│ │ 生产许可证  │ SC1234567      │ 模板    │ ✅ 已完成 │  │
│ │ 有机编码    │ 2490P1800146   │ 数据源  │ ✅ 已完成 │  │
│ │ 配料表      │ 黑芝麻         │ 采集    │ 🟡 待确认 │  │
│ │ 保质期      │ 12个月         │ 采集    │ ✅ 已完成 │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│ 🚚 物流售后（来源：类目模板）                             │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 发货地      │ 浙江杭州        │ 模板    │ ✅ 已完成 │  │
│ │ 发货时效    │ 24小时内        │ 模板    │ ✅ 已完成 │  │
│ │ 运费模板    │ 包邮模板A       │ 模板    │ ✅ 已完成 │  │
│ │ 退换货承诺  │ 7天无理由       │ 模板    │ ✅ 已完成 │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  统计：已完成 15 / 待确认 3 / 待填写 2 / 待生成 2        │
│                                                         │
│                              [← 上一步]  [下一步 →]     │
└─────────────────────────────────────────────────────────┘
```

#### 步骤4：编辑SKU

```
┌─────────────────────────────────────────────────────────┐
│ 编辑SKU                                         步骤 4/5 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  SKU列表（来源：采集 + 数据源）                          │
│ ┌───────────────────────────────────────────────────┐  │
│ │    │ 规格图 │ 规格名称           │ 商家编码 │ 有机编码 │  │
│ ├───────────────────────────────────────────────────┤  │
│ │ 1  │ [图]  │ 有机黑芝麻600g(熟) │ SKU001  │ 2490P18..│  │
│ │ 2  │ [图]  │ 有机黑芝麻730g(生) │ SKU002  │ 2490P18..│  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  💰 价格库存（必填）                                     │
│ ┌───────────────────────────────────────────────────┐  │
│ │    │ 规格名称           │ 价格(元) │ 库存  │ 上架  │  │
│ ├───────────────────────────────────────────────────┤  │
│ │ 1  │ 有机黑芝麻600g(熟) │ [     ] │ [   ] │ [✓]  │  │
│ │ 2  │ 有机黑芝麻730g(生) │ [     ] │ [   ] │ [✓]  │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  [批量设置价格]  [批量设置库存]                          │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  📦 SKU产品信息（来源：采集 + 数据源）                    │
│ ┌───────────────────────────────────────────────────┐  │
│ │    │ 规格名称      │ 条形码      │ 净含量  │ 状态   │  │
│ ├───────────────────────────────────────────────────┤  │
│ │ 1  │ 600g(熟)     │ 6901234567 │ 600g   │ ✅     │  │
│ │ 2  │ 730g(生)     │ 6901234568 │ 730g   │ 🔴 缺  │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│                              [← 上一步]  [下一步 →]     │
└─────────────────────────────────────────────────────────┘
```

#### 步骤5：提交上架

```
┌─────────────────────────────────────────────────────────┐
│ 提交上架                                        步骤 5/5 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  上架前检查                                              │
│ ┌───────────────────────────────────────────────────┐  │
│ │ ✅ 必填字段已完成 (22/22)                          │  │
│ │ ✅ 图片已上传 (8张)                                │  │
│ │ ✅ SKU信息完整 (2个)                               │  │
│ │ ✅ 价格库存已填写                                  │  │
│ │ ⚠️ 白底图未生成（可选）                            │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  ─────────────────────────────────────────────────────  │
│                                                         │
│  商品预览                                                │
│ ┌───────────────────────────────────────────────────┐  │
│ │  [主图]  有机黑芝麻600g 九月的诗 五谷杂粮           │  │
│ │          ¥XX.XX                                   │  │
│ │          SKU: 2个                                 │  │
│ │          类目: 粮油调味 > 米/面粉/杂粮 > 特色米     │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  上架方式：                                              │
│  ○ 立刻上架                                             │
│  ○ 定时上架  [选择时间]                                  │
│  ● 放入仓库                                             │
│                                                         │
│                              [← 上一步]  [提交上架]     │
└─────────────────────────────────────────────────────────┘
```

### 8.7 设置页面

#### 8.7.1 店铺授权

```
┌─────────────────────────────────────────────────────────┐
│ 设置 > 店铺授权                                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  已授权店铺                                              │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 九月的诗旗舰店                                     │  │
│ │    授权状态：✅ 有效                                │  │
│ │    到期时间：2027-02-01                            │  │
│ │    [刷新授权] [解除授权]                            │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  [+ 添加店铺授权]                                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 8.7.2 数据源配置

```
┌─────────────────────────────────────────────────────────┐
│ 设置 > 数据源                                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  已配置数据源                                            │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 钉钉表格 - 有机证书                                 │  │
│ │    匹配字段：链接(B列)                              │  │
│ │    导入字段：商家编码、有机编码、厂家、证书图片       │  │
│ │    记录数：89条                                     │  │
│ │    [编辑] [同步] [删除]                             │  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  [+ 添加数据源]                                          │
│                                                         │
│  支持的数据源类型：                                       │
│  • 钉钉多维表格                                          │
│  • 飞书多维表格                                          │
│  • Excel/CSV 上传                                       │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 8.8 模板管理页面

```
┌─────────────────────────────────────────────────────────┐
│ 模板管理                                                 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  类目模板                                                │
│ ┌───────────────────────────────────────────────────┐  │
│ │ 类目                  │ 来源商品       │ 字段数 │ 操作│  │
│ ├───────────────────────────────────────────────────┤  │
│ │ 特色米/面粉/杂粮      │ 有机黑芝麻600g │ 12    │ 编辑│  │
│ │ 坚果/特产             │ 有机核桃仁     │ 10    │ 编辑│  │
│ │ 方便粉丝/米线         │ 红薯粉条       │ 11    │ 编辑│  │
│ └───────────────────────────────────────────────────┘  │
│                                                         │
│  [+ 从已有商品创建模板]                                   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 8.9 状态标识说明

| 标识 | 状态 | 说明 |
|:----:|------|------|
| ✅ | 已完成 | 字段已填充，无需处理 |
| 🟡 | 待确认 | 已有值，需人工确认 |
| 🔴 | 待填写 | 必填但为空 |
| 🔵 | 待生成 | 需AI生成 |
| ⚪ | 可选 | 非必填，可跳过 |

### 8.10 技术架构

```
┌─────────────────────────────────────────────────────────┐
│                       用户浏览器                         │
│  ┌───────────────────────────────────────────────────┐ │
│  │                 Web GUI (前端)                     │ │
│  │                 - React / Vue                      │ │
│  │                 - 本地运行 (localhost:3000)        │ │
│  └───────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                            ↕ HTTP API
┌─────────────────────────────────────────────────────────┐
│                      本地后端服务                        │
│  ┌───────────────────────────────────────────────────┐ │
│  │                 API Server (Python)                │ │
│  │                 - FastAPI                          │ │
│  │                 - 本地运行 (localhost:8000)        │ │
│  └───────────────────────────────────────────────────┘ │
│                            ↕                            │
│  ┌────────────────┐  ┌────────────────┐  ┌──────────┐ │
│  │ 淘宝 Open API  │  │ 钉钉/飞书 API  │  │ AI 服务  │ │
│  │ - OAuth 授权   │  │ - OAuth 授权   │  │ - 白底图 │ │
│  │ - Schema API   │  │ - 表格读取     │  │ - 裁剪   │ │
│  │ - 图片上传     │  │                │  │          │ │
│  └────────────────┘  └────────────────┘  └──────────┘ │
└─────────────────────────────────────────────────────────┘
```

---

## 9. 数据设计（更新）

### 9.1 核心数据实体

| 实体 | 用途 | 关键字段 |
|------|------|----------|
| **店铺授权** | OAuth Token 管理 | shop_id, access_token, refresh_token, expires_at |
| **采集商品** | 源商品数据 | source_url, title, price, images, skus, description |
| **Schema 缓存** | 类目规则缓存 | category_id, schema_xml, updated_at |
| **字段匹配记录** | 匹配规则学习 | source_field, schema_field_id, category_id |
| **上架记录** | 追踪上架结果 | item_id, source_url, status, created_at |

### 9.2 数据关系

```
店铺授权 ──1:N──→ 上架记录
                    ↓
采集商品 ──1:1──→ 上架记录
                    ↓
Schema缓存 ←── 字段匹配记录
                    ↓
外部数据源 ←── 数据源配置
```

### 9.3 外部数据源实体（新增）

| 实体 | 用途 | 关键字段 |
|------|------|----------|
| **数据源配置** | 外部表格连接 | source_type, access_token, table_id, field_mapping |
| **数据源记录** | 缓存的表格数据 | source_id, match_key(链接), fields_json |
| **类目模板** | 类目默认值 | category_id, template_fields, source_item_id |

---

## 10. 异常与兜底（更新）

### 10.1 API 错误处理

| 错误类型 | 处理策略 |
|----------|----------|
| Token 过期 | 自动刷新 Token，失败则提示重新授权 |
| 参数校验失败 | 高亮错误字段，提示用户修改 |
| 类目不支持 | 提示用户选择其他类目 |
| 图片上传失败 | 自动重试 3 次，失败则提示 |
| 网络超时 | 自动重试，失败则提示 |
| API 限流 | 等待后重试 |

### 10.2 兜底原则

| 原则 | 说明 |
|------|------|
| **数据不丢失** | 采集数据、匹配结果本地保存 |
| **可恢复** | 失败后可从字段匹配步骤继续 |
| **错误可理解** | API 错误翻译成用户能理解的提示 |

---

## 11. 开放问题（更新）

### 11.1 待后续明确

| # | 问题 | 说明 | 何时解决 |
|---|------|------|----------|
| 1 | 开放平台资质 | 需要申请淘宝开放平台 ISV 资质 | 研发前 |
| 2 | 前端技术选型 | React vs Vue | 研发阶段 |
| 3 | 商品采集方式 | 爬虫 vs 淘宝 API | 研发阶段 |
| 4 | 淘宝 vs 天猫 API 差异 | 两个平台的 Schema API 是否一致 | 研发阶段 |

### 11.2 MVP 边界

| 范围 | MVP 包含 | 后续迭代 |
|------|----------|----------|
| 商品来源 | 淘宝/天猫 | 1688、拼多多 |
| 目标店铺 | 单店铺 | 多店铺 |
| 类目 | 食品类目 | 其他类目 |
| 操作模式 | 单品 | 批量 |
| 数据源 | 钉钉表格 | 飞书、Excel |

---

## 更新记录

| 版本 | 日期 | 变更说明 |
|------|------|----------|
| v1 | 2026-01-29 | 初始版本（CLI + 浏览器模拟） |
| v1.1 | 2026-01-30 | 补充 codegen 交互设计 |
| v1.2 | 2026-01-30 | 新增学习驱动初始化设计 |
| v1.3 | 2026-01-30 | 新增概览章节 |
| v1.4 | 2026-01-30 | 完善 CLI 交互设计 |
| v2.0 | 2026-01-31 | 重大变更：Open API + Web GUI + 字段匹配确认 |
| **v3.0** | **2026-02-01** | **新增：字段清单、外部数据源、类目模板、首次引导流程、完整交互设计** |
